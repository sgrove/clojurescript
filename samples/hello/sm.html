<!DOCTYPE HTML>

<html lang="en-GB">

<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	
	<link rel="stylesheet" type="text/css" href="_styles.css" media="screen" />
	<link href="jquery.contextMenu.css" rel="stylesheet" type="text/css" />

	<script src="source-map.js"></script>
	<script src="hello.js"></script>
	

	<script src="jquery-1.7.1.min.js" type="text/javascript"></script>
    <script src="jquery.ui.position.js" type="text/javascript"></script>
    <script src="jquery.contextMenu.min.js" type="text/javascript"></script>
   
	

	<script>
		var source_map, source, output, getOriginalLocation,
			rnewline = /\r?\n|\r/g;
		
		window.addEventListener("DOMContentLoaded", function(){
			source = document.getElementById("source");
			output = document.getElementById("output");

			$.get("/hello.js.map.merged",function(map) {
				source_map = new sourceMap.SourceMapConsumer(map);
			});


		$.get("/hello.js",function(s) {
		$(source).val(s);
			});

    getOriginalLocation = function getOriginalLocation() {
                var absColumn = column = source.selectionStart,
                    pos = source.value.slice(0,column),
                    line = 1;
                    lineCount = pos.split(rnewline),
                    figure = 0;

                    for(var i = 0; i<lineCount.length-1; i++) {
                        figure = figure+(lineCount[i].length);
                    }

					figure = figure+(lineCount.length-1);
                    column = absColumn - figure;

                
				var lookup = {line: lineCount.length ? lineCount.length : line , column: column};
				
				output.value = "Line: " + lookup.line + ", column: " + lookup.column + " in generated code maps to: \n" + JSON.stringify(source_map.originalPositionFor(lookup));
				console.log(source_map.originalPositionFor(lookup));
			};

			if(!('contextMenu' in document.body && 'HTMLMenuItemElement' in window)) {
				$.contextMenu({selector: '#source', items: {
	                edit: {name: "Get original location", callback: getOriginalLocation}
	            }});
			}
		}, false);		
	</script>

	<script type="text/javascript">
        
    </script>
	
	<title>Source Mapping Hotness | The CSS Ninja</title>

</head>
<body>
	
	<div id="cssninja">
		<p><a href="http://www.thecssninja.com/">Example from the [CSS] Ninja</a></p>
	</div>
	
	<menu type="context" id="sourcemapmenu">
      <menuitem label="Get original location" onclick="getOriginalLocation()">
    </menu>
    <div class="container">
	    <h1>Source map</h1>
	    <p>Place cursor anywhere in the source code textarea and right click > "Get original location"</p>
		
		<h2>Output</h2>
		<textarea id="output" rows="2" readonly></textarea>
		<h2>Source code</h2>
		<textarea id="source" contextmenu="sourcemapmenu" rows="30"></textarea>
	</div>
	
	
	<!-- Google analytics -->
	<script type="text/javascript">
		var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
		document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
	</script>
	<script type="text/javascript">
		var pageTracker = _gat._getTracker("UA-4638292-1");
		pageTracker._initData();
		pageTracker._trackPageview();
	</script>
</body>
</html>
